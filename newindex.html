<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Matching System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        function DogMatcher() {
          const [view, setView] = useState('about');
          const [dogs, setDogs] = useState([]);
          const [matches, setMatches] = useState([]);
          
          const [userPrefs, setUserPrefs] = useState({
            livingSpace: 'house',
            hasYard: 'yes',
            experience: 'some',
            activity: 'moderate',
            hasChildren: 'no',
            hasPets: 'no',
            petType: 'none',
            groomingTime: 'moderate',
            needsHypoallergenic: 'no',
            trainingTime: 'yes'
          });

          const dogImages = {
            'Lotte': 'images/lotte.jpg',
            'Buttermilk': 'images/buttermilk.jpg',
            'Cagney': 'images/cagney.jpg',
            'Chrissy': 'images/chrissy.jpg',
            'Copper': 'images/copper.jpg',
            'Julius': 'images/julius.jpg',
            'Lacey Lou': 'images/lacey-lou.jpg',
            'Muffin': 'images/muffin.jpg',
            'Waffles': 'images/waffles.jpg',
            'Mollie': null
          };

          useEffect(() => {
            const csvData = `Name,Sex,Breed ,Age ,Size ,Energy Level ,Temperament,Grooming Needs,Experience Required,Hypoallergenic? ,Potty trained?,Leash trained? ,Crate trained? ,Good with other dogs? ,Good with cats? ,Good with little kids? (5 and younger)
Muffin,Female,Basset Hound & Hound Mix,4 years,Medium,High,"Friendly, social, sweet",Low,None,No,Yes,Yes,Yes,Yes,No,Yes
Julius,Male,Australian Cattle Dog & Blue Heeler & Hound Mix,6 months,Medium,High,"Playful, sweet",Low,None,No,Yes,Yes,Yes,Yes,Unknown,Yes
Mollie,Female,Shepherd Mix,10 years,Medium,Medium,"Friendly, gentle, anxious",Medium,None,No,Yes,Yes,Yes,Yes,No,Yes
Buttermilk,Male,Terrier Mix,6 months,Medium,High,"Friendly, active",Low,None,No,No,No,No,Yes,Unknown,No
Chrissy,Female,Hound Mix,3 years,Medium,High,"Loving, exciteable",Low,None,No,Yes,No,Yes,Yes,No,Yes
Lotte,Female,Mountain Cur Mix,8 years,Medium,Medium,"Anxious, smart, loving",Low,None,No,Yes,Yes,Yes,Yes,Unknown,No
Waffles,Male,Terrier Mix,6 months,Medium,High,"Friendly, active",Low,None,No,No,No,No,Yes,Unknown,No
Lacey Lou,Female,Hound & Mixed Breed Mix,7 months,Medium,High,"Social, sweet",Low,None,No,No,No,Yes,Yes,Unknown,No
Copper,Male,Australian Cattle Dog & Labrador Retriever Mix,4 years,Medium,High,"Affectionate, smart",Low,None,No,Yes,Yes,Yes,Yes,Yes,No
Cagney,Female,Chesapeake Bay Retriever & Hound,6 months,Medium,High,"Outgoing, friendly",Low,None,No,Yes,No,No,Yes,Yes,No`;
            
            Papa.parse(csvData, {
              header: true,
              skipEmptyLines: true,
              complete: (results) => {
                const importedDogs = results.data.map((row, index) => {
                  const goodWith = [];
                  const goodWithOtherDogs = parseGoodWith(row['Good with other dogs? ']);
                  const goodWithCats = parseGoodWith(row['Good with cats? ']);
                  const goodWithKids = parseGoodWith(row['Good with little kids? (5 and younger)']);
                  
                  if (goodWithOtherDogs === 'yes') goodWith.push('Other Dogs');
                  if (goodWithCats === 'yes') goodWith.push('Cats');
                  if (goodWithKids === 'yes') goodWith.push('Children');

                  return {
                    id: Date.now() + index,
                    name: row['Name'] || '',
                    breed: row['Breed '] || row['Breed'] || '',
                    age: row['Age '] || row['Age'] || '',
                    sex: row['Sex'] || '',
                    size: mapSize(row['Size '] || row['Size'] || 'medium'),
                    energy: mapEnergyGrooming(row['Energy Level '] || row['Energy Level'] || 'medium'),
                    temperament: parseTemperament(row['Temperament']),
                    goodWith: goodWith,
                    goodWithOtherDogs: goodWithOtherDogs,
                    goodWithCats: goodWithCats,
                    goodWithKids: goodWithKids,
                    grooming: mapEnergyGrooming(row['Grooming Needs'] || 'medium'),
                    experience: mapExperience(String(row['Experience Required'] || 'any')),
                    hypoallergenic: parseBoolean(row['Hypoallergenic? '] || row['Hypoallergenic?']),
                    leashTrained: parseBoolean(row['Leash trained?']),
                    pottyTrained: parseBoolean(row['Potty trained?']),
                    crateTrained: parseBoolean(row['Crate trained?']),
                    description: row['Description'] || ''
                  };
                });

                setDogs(importedDogs);
              }
            });
          }, []);

          const parseBoolean = (value) => {
            if (typeof value === 'boolean') return value;
            if (typeof value === 'string') {
              const cleaned = value.trim().toLowerCase();
              return cleaned === 'yes' || cleaned === 'true' || cleaned === '1';
            }
            return false;
          };

          const parseGoodWith = (value) => {
            if (!value) return 'unknown';
            const cleaned = value.trim().toLowerCase();
            if (cleaned === 'yes' || cleaned === 'true') return 'yes';
            if (cleaned === 'no' || cleaned === 'false') return 'no';
            return 'unknown';
          };

          const mapSize = (value) => {
            const cleaned = value.trim().toLowerCase();
            if (cleaned.includes('small')) return 'small';
            if (cleaned.includes('large')) return 'large';
            return 'medium';
          };

          const mapEnergyGrooming = (value) => {
            const cleaned = value.trim().toLowerCase();
            if (cleaned.includes('low')) return 'low';
            if (cleaned.includes('high')) return 'high';
            return 'medium';
          };

          const mapExperience = (value) => {
            if (!value) return 'any';
            const cleaned = value.trim().toLowerCase();
            if (cleaned === 'none' || cleaned === 'any') return 'any';
            if (cleaned.includes('beginner')) return 'beginner';
            if (cleaned.includes('experienced')) return 'experienced';
            if (cleaned.includes('some')) return 'some';
            return 'any';
          };

          const parseTemperament = (value) => {
            if (!value) return [];
            const traits = value.split(',').map(t => t.trim());
            const validTraits = ['Friendly', 'Playful', 'Calm', 'Protective', 'Independent', 'Affectionate', 'Energetic', 'Gentle'];
            return traits.filter(t => validTraits.some(v => v.toLowerCase() === t.toLowerCase()))
              .map(t => validTraits.find(v => v.toLowerCase() === t.toLowerCase()));
          };

          const calculateMatch = () => {
            if (userPrefs.needsHypoallergenic === 'yes') {
              const hasHypoallergenicDogs = dogs.some(dog => dog.hypoallergenic);
              if (!hasHypoallergenicDogs) {
                setMatches([]);
                setView('results');
                return;
              }
            }

            const scored = dogs.map(dog => {
              const isPuppy = dog.age && (
                dog.age.toLowerCase().includes('month') ||
                dog.age.toLowerCase().includes('week') ||
                (dog.age.match(/(\d+)/) && parseInt(dog.age.match(/(\d+)/)[0]) < 2)
              );

              let score = 0;
              let maxScore = 0;
              let warnings = [];

              if (isPuppy) {
                maxScore += 30;
                if (userPrefs.trainingTime === 'no') {
                  warnings.push('Puppies require significant training time');
                  score += 5;
                } else if (userPrefs.trainingTime === 'yes') {
                  score += 30;
                }

                maxScore += 25;
                if (userPrefs.livingSpace === 'apartment' && userPrefs.hasYard === 'no') {
                  warnings.push('Puppies need outdoor access for house training');
                  score += 5;
                } else {
                  score += 25;
                }

                maxScore += 25;
                if (userPrefs.activity === 'low') {
                  warnings.push('Puppies need daily active exercise');
                  score += 5;
                } else if (userPrefs.activity === 'moderate') {
                  score += 18;
                } else {
                  score += 25;
                }
              }

              if (userPrefs.trainingTime === 'no' && !isPuppy) {
                maxScore += 20;
                const isFullyTrained = dog.leashTrained && dog.pottyTrained && dog.crateTrained;
                if (isFullyTrained) {
                  score += 20;
                } else {
                  warnings.push('May need additional training');
                  score += 5;
                }
              }

              maxScore += 25;
              if (userPrefs.livingSpace === 'apartment') {
                if (dog.size === 'small') score += 25;
                else if (dog.size === 'medium') score += 15;
                else {
                  score += 5;
                  warnings.push('Large dogs need more space');
                }
              } else {
                if (dog.size === 'small') score += 20;
                else if (dog.size === 'medium') score += 25;
                else if (dog.size === 'large' && userPrefs.hasYard === 'yes') score += 25;
                else score += 15;
              }

              maxScore += 30;
              const energyMap = { low: 0, medium: 1, high: 2 };
              const activityMap = { low: 0, moderate: 1, active: 2 };
              
              let dogEnergyLevel = isPuppy ? 2 : (energyMap[dog.energy] || 1);
              let userActivityLevel = activityMap[userPrefs.activity] || 1;
              const energyDiff = Math.abs(dogEnergyLevel - userActivityLevel);
              
              if (energyDiff === 0) score += 30;
              else if (energyDiff === 1) score += 15;
              else {
                score += 5;
                warnings.push('Energy level mismatch - may need more/less exercise than preferred');
              }

              const highEnergyBreeds = ['border collie', 'australian shepherd', 'jack russell', 'husky', 
                                        'vizsla', 'weimaraner', 'belgian malinois', 'cattle dog'];
              const isHighEnergyBreed = highEnergyBreeds.some(breed => 
                dog.breed.toLowerCase().includes(breed)
              );
              
              if (isHighEnergyBreed && userPrefs.activity === 'low') {
                warnings.push('This breed needs substantial daily exercise');
                score -= 15;
              }

              maxScore += 20;
              if (isPuppy) {
                if (userPrefs.experience === 'none') {
                  score += 5;
                  warnings.push('First-time owners should research puppy training extensively');
                }
                else if (userPrefs.experience === 'some') score += 15;
                else score += 20;
              } else {
                if (dog.experience === 'any') score += 20;
                else if (dog.experience === userPrefs.experience) score += 20;
                else if (dog.experience === 'beginner' && userPrefs.experience !== 'none') score += 15;
                else score += 10;
              }

              if (userPrefs.hasChildren === 'yes') {
                maxScore += 30;
                if (isPuppy) {
                  if (dog.goodWithKids === 'yes') score += 25;
                  else if (dog.goodWithKids === 'unknown') {
                    score += 10;
                    warnings.push('Compatibility with children unknown - supervision required');
                  }
                  else {
                    score += 0;
                    warnings.push('Not recommended for young children');
                  }
                } else {
                  if (dog.goodWithKids === 'yes') score += 30;
                  else if (dog
